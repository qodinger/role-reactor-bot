# Git Workflow Standards

This rule defines the Git workflow and branch strategy for the Role Reactor Bot project. Always follow this workflow when making commits or creating branches.

## Branch Strategy

### Branch Types and Usage

1. **`main`** - Production-ready code
   - Always stable and deployable
   - Only merge tested, working code
   - Use for small fixes/updates (direct commits)

2. **`dev`** - Development integration branch
   - Integration branch for multiple features
   - Used for testing feature combinations
   - Merged to `main` when ready for release

3. **`feature/*`** - Feature development branches
   - Named: `feature/command-name`, `feature/userinfo-serverinfo`, etc.
   - Created from `dev` or `main`
   - Merged back to `dev` or `main` when complete

4. **`fix/*`** - Bug fix branches
   - Named: `fix/help-command-patterns`, `fix/level-up-notifications`, etc.
   - Created from `main` for urgent fixes
   - Merged directly to `main` (can also merge to `dev`)

5. **`hotfix/*`** - Critical production fixes
   - Named: `hotfix/deployment-issue`, `hotfix/security-patch`, etc.
   - Created from `main` for urgent production issues
   - Merged to both `main` and `dev`

## Workflow Decision Rules

### When to Push Directly to Main

Push directly to `main` for:

- Small bug fixes
- Documentation updates
- Code cleanup
- Help system updates
- Minor refactoring
- Configuration updates

**Process:**

```bash
git checkout main && git pull origin main
# Make changes
git add .
git commit -m "fix(scope): description"  # or appropriate type
git push origin main
```

### When to Use Feature Branches

Use feature branches for:

- New commands
- Major refactoring
- New systems/features
- Significant changes
- Experimental features

**Process:**

```bash
# Using Git helpers (preferred)
source scripts/git-helpers.sh
git-feature feature-name
# ... develop ...
git-finish-feature

# Or manually
git checkout dev && git pull origin dev
git checkout -b feature/feature-name
# ... develop ...
git checkout dev && git merge feature/feature-name
git push origin dev
```

### When to Use Fix Branches

Use fix branches for:

- Bug fixes that need isolation
- Fixes that require testing before merging
- Fixes affecting multiple files

**Process:**

```bash
# Using Git helpers (preferred)
source scripts/git-helpers.sh
git-fix fix-name
# ... fix ...
git-finish-fix

# Or manually
git checkout main && git pull origin main
git checkout -b fix/fix-name
# ... fix ...
git checkout main && git merge fix/fix-name
git push origin main
```

### When to Use Hotfix Branches

Use hotfix branches for:

- Critical production issues
- Security patches
- Urgent deployment fixes

**Process:**

```bash
# Using Git helpers (preferred)
source scripts/git-helpers.sh
git-hotfix hotfix-name
# ... fix ...
git-finish-hotfix

# Or manually
git checkout main && git pull origin main
git checkout -b hotfix/hotfix-name
# ... fix ...
git checkout main && git merge hotfix/hotfix-name
git push origin main
git checkout dev && git merge hotfix/hotfix-name
git push origin dev
```

## Commit Message Convention

**ALWAYS** use [Conventional Commits](https://www.conventionalcommits.org/) format:

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `style`: Code style changes (formatting, etc.)
- `refactor`: Code refactoring
- `perf`: Performance improvements
- `test`: Adding or updating tests
- `chore`: Maintenance tasks
- `hotfix`: Critical production fix

### Examples:

```bash
git commit -m "feat(commands): add userinfo and serverinfo commands"
git commit -m "fix(help): correct command patterns in help system"
git commit -m "docs(changelog): update unreleased section"
git commit -m "refactor(avatar): simplify embed creation"
```

## Branch Naming Conventions

- **Features**: `feature/command-name`, `feature/userinfo-serverinfo`
- **Fixes**: `fix/help-patterns`, `fix/level-up-notifications`
- **Hotfixes**: `hotfix/deployment-issue`, `hotfix/security-patch`
- **Docs**: `docs/update-readme`, `docs/add-workflow-guide`

## Git Helper Scripts

The project includes helper scripts in `scripts/git-helpers.sh`:

**Available commands:**

- `git-feature <name>` - Create feature branch
- `git-finish-feature` - Merge feature to dev and cleanup
- `git-fix <name>` - Create fix branch
- `git-finish-fix` - Merge fix to main and cleanup
- `git-hotfix <name>` - Create hotfix branch
- `git-finish-hotfix` - Merge hotfix to main and dev
- `git-sync-main` - Sync current branch with main
- `git-sync-dev` - Sync current branch with dev
- `git-workflow-help` - Show all available commands

**Usage:**

```bash
source scripts/git-helpers.sh
git-feature feature-name
```

## AI Assistant Instructions

When the user asks to commit changes or create branches:

1. **Determine the change type:**
   - Small fix/update → Direct to main
   - New feature → Feature branch
   - Bug fix → Fix branch
   - Critical issue → Hotfix branch

2. **Use appropriate workflow:**
   - For small changes: Commit directly to main
   - For features: Suggest using `git-feature` or create feature branch
   - For fixes: Suggest using `git-fix` or create fix branch
   - For hotfixes: Suggest using `git-hotfix` or create hotfix branch

3. **Always use Conventional Commits format** for commit messages

4. **Suggest using Git helpers** when appropriate (feature/fix/hotfix branches)

5. **Organize commits by feature/section** when committing multiple changes:

   ```bash
   # Example: Multiple related changes
   git add src/commands/general/userinfo/
   git commit -m "feat(commands): add userinfo command"

   git add src/commands/general/serverinfo/
   git commit -m "feat(commands): add serverinfo command"

   git add docs/CHANGELOG.md
   git commit -m "docs(changelog): update unreleased section"
   ```

6. **Never skip the workflow** - Always follow the branch strategy

## Documentation References

- Full workflow guide: `docs/GIT_WORKFLOW.md`
- Setup instructions: `docs/GIT_WORKFLOW_SETUP.md`
- Helper scripts: `scripts/git-helpers.sh`
